(function(){var a={};window.tributary=a,a.events=_.clone(Backbone.Events),a.data={},window.trib={},window.trib_options={},window.addEventListener("resize",function(b){a.events.trigger("resize",b)}),a.CodeModel=Backbone.Model.extend({defaults:{code:"",filename:"inlet.js",name:"inlet",type:"js",config:{coffee:!1,vim:!1,emacs:!1,hide:!1}},initialize:function(){this.binder()},binder:function(){this.on("error",this.handle_error)},handle_error:function(b){a.trace&&(console.trace(),console.log(b))},handle_coffee:function(){var a=this.get("code");return this.get("config").coffee&&(a=CoffeeScript.compile(a,{bare:!0})),a},local_storage:function(a){a||(a="");var b=this.get("filename")+"/code/"+a;return localStorage[b]},set_local_storage:function(a,b){var c=this.get("filename")+"/code/"+b;localStorage[c]=a}}),a.CodeModels=Backbone.Collection.extend({model:a.CodeModel}),a.Config=Backbone.Model.extend({defaults:{endpoint:"tributary","public":!0}}),a.Context=Backbone.View.extend({initialize:function(){this.model.on("change:code",this.execute,this)},execute:function(){var b=this.model.handle_coffee();try{a.initialize=new Function("g",b)}catch(c){return this.trigger("error",c),!1}try{window.trib={},window.trib_options={},trib=window.trib,trib_options=window.trib_options,$(this.el).children("svg").empty(),a.initialize(this.svg)}catch(d){return this.model.trigger("error",d),!1}return this.model.trigger("noerror"),!0},render:function(){this.svg=d3.select(this.el).append("svg").attr({xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink","class":"tributary_svg"})}}),a.JSONContext=Backbone.View.extend({initialize:function(){this.model.on("code",this.execute,this)},execute:function(){try{var b=JSON.parse(this.model.get("code"));a[this.model.get("name")]=b}catch(c){return this.model.trigger("error",c),!1}return this.model.trigger("noerror"),!0},render:function(){}}),a.Editor=Backbone.View.extend({initialize:function(){this.config=this.model.get("config")},render:function(){var a=this;d3.select(this.el).attr({"class":"editor"}),this.cm=CodeMirror(this.el,{mode:"javascript",theme:"lesser-dark",lineNumbers:!0,onChange:function(){var b=a.cm.getValue();a.model.set("code",b)}}),this.cm.setValue(this.model.get("code")),this.inlet=Inlet(this.cm)}}),a.gist=function(b,c){var d={},e="?cachebust="+Math.random()*0xf12765df4c9b2;d3.json("https://api.github.com/gists/"+b+e,function(b){b.user===null||b.user===undefined?d.user={login:"anon",url:"",userid:-1}:d.user=b.user;var e;try{e=b.files["config.json"]}catch(f){e=!1}if(e)try{d.config=new a.Config(JSON.parse(e.content))}catch(g){d.config=new a.Config}else d.config=new a.Config;var h=_.keys(b.files);d.models=new a.CodeModels;var i,j,k,l=0,m;h.forEach(function(c){i=c.split("."),m=i[i.length-1],c!=="config.json"&&(j=new a.CodeModel({filename:c,name:i[0],code:b.files[c].content,type:m,config:d.config.toJSON()}),d.models.add(j))}),c(d)})},a.DeltaContext=Backbone.View.extend({initialize:function(){},render:function(){}})})();