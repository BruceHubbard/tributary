(function(){var a={};window.tributary=a,window.trib={},window.trib_options={},a.CodeModel=Backbone.Model.extend({defaults:{code:"",filename:"inlet.js",name:"inlet",type:"js",config:{coffee:!1,vim:!1,emacs:!1,hide:!1}},initialize:function(){this.binder()},binder:function(){this.on("error",this.handle_error)},handle_error:function(b){a.trace&&(console.trace(),console.error(b))},local_storage:function(a){a||(a="");var b=this.get("filename")+"/code/"+a;return localStorage[b]},set_local_storage:function(a,b){var c=this.get("filename")+"/code/"+b;localStorage[c]=a}}),a.CodeModels=Backbone.Model.extend({model:a.CodeModel}),a.Config=Backbone.Model.extend({defaults:{endpoint:"tributary","public":!0}}),a.Context=Backbone.View.extend({initialize:function(){},render:function(){}}),a.JSONContext=Backbone.View.extend({initialize:function(){this.model.on("code",this.execute)},execute:function(){try{var b=JSON.parse(this.get("code"));a[this.get("name")]=b}catch(c){return this.trigger("error",c),!1}return this.trigger("noerror"),!0},render:function(){}}),a.EditorView=Backbone.View.extend({initialize:function(){this.config=this.model.get("config")},render:function(){var a=this;console.log("editor el",this.el),this.cm=CodeMirror(this.el,{mode:"javascript",theme:"lesser-dark",lineNumbers:!0,onChange:function(){var b=cm.getValue();a.config.coffee&&(b=CoffeeScript.compile(b,{bare:!0})),a.model.trigger("code",b)}})}}),a.gist=function(b,c){var d={},e="?cachebust="+Math.random()*0xf12765df4c9b2;d3.json("https://api.github.com/gists/"+b+e,function(b){b.user===null||b.user===undefined?d.user={login:"anon",url:"",userid:-1}:d.user=b.user;var e;try{e=b.files["config.json"]}catch(f){e=!1}if(e)try{d.config=new a.Config(JSON.parse(e.content))}catch(g){d.config=new a.Config}else d.config=new a.Config;var h=_.keys(b.files),i,j,k,l=0,m;h.forEach(function(c){i=c.split("."),m=i[i.length-1],c!=="config.json"&&(j=new a.CodeModel({filename:c,name:i[0],code:b.files[c].content,type:m,config:d.config.toJSON()}))}),c(d)})},a.DeltaContext=Backbone.View.extend({initialize:function(){},render:function(){}})})();